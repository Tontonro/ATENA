<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Gerenciamento de Acervo do NUARTE - IFRN Campus Santa Cruz">
    <title>ATENA ‚Ä¢ NUARTE | Acervo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { display: ['"Space Grotesk"', 'system-ui', 'sans-serif'] },
            colors: { brand: { 50: '#fefce8', 100: '#fef9c3', 400: '#facc15', 500: '#eab308' } }
          }
        }
      }
    </script>
    <style>
        .tab-button.active {
            background-color: rgba(250, 204, 21, 0.15);
            border-bottom-color: rgb(250, 204, 21);
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 font-display">
    <nav class="sticky top-0 z-30 backdrop-blur bg-slate-950/80 border-b border-slate-800">
        <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-brand-500/15 border border-brand-500/40 flex items-center justify-center text-brand-400 font-bold">AT</div>
                <div>
                    <p class="text-sm text-slate-300">Atena ‚Ä¢ NUARTE</p>
                    <p class="text-xs text-slate-500">IFRN Campus Santa Cruz</p>
                </div>
            </div>
            <div class="flex items-center gap-6 text-sm font-medium">
                <a class="hover:text-brand-400 transition" href="index.html">In√≠cio</a>
                <a class="hover:text-brand-400 transition" href="about.html">Sobre</a>
                <a class="hover:text-brand-400 transition" href="login.html">Login</a>
                <a class="text-brand-400" aria-current="page" href="figurinos.html">Acervo</a>
            </div>
        </div>
    </nav>

    <main class="relative min-h-[calc(100vh-64px)] bg-gradient-to-br from-slate-950 via-slate-950 to-blue-900 text-slate-100 overflow-hidden">
        <div class="absolute inset-0 opacity-50 pointer-events-none" aria-hidden="true">
            <div class="w-80 h-80 bg-brand-500/12 blur-3xl rounded-full absolute -top-24 -left-12"></div>
            <div class="w-72 h-72 bg-sky-500/10 blur-3xl rounded-full absolute bottom-0 right-10"></div>
        </div>
        <section class="relative max-w-6xl mx-auto px-4 py-12 space-y-10">
            <div class="grid lg:grid-cols-[1.15fr_0.85fr] gap-10 items-start">
                <div class="space-y-6">
                    <div class="flex flex-wrap items-center gap-3">
                        <span class="px-3 py-1 rounded-full bg-brand-500/15 border border-brand-500/30 text-brand-300 text-xs font-semibold uppercase tracking-[0.2em]">Acervo NUARTE</span>
                        <span class="px-3 py-1 rounded-full bg-slate-900/70 border border-slate-800 text-slate-200 text-xs font-semibold uppercase tracking-[0.2em]">6 categorias</span>
                    </div>
                    <div class="space-y-3">
                        <h1 class="text-4xl md:text-5xl font-bold text-brand-100 leading-tight">Painel do acervo</h1>
                        <p class="text-slate-200 text-lg max-w-2xl">Consulta aberta; edi√ß√£o apenas para bolsistas.</p>
                    </div>
                    <div id="loginIndicator" class="flex flex-wrap items-center gap-3">
                        <div id="userInfo" class="hidden bg-green-500/10 text-green-200 px-4 py-2 rounded-lg border border-green-500/25 shadow-sm shadow-green-500/10">
                            <span id="userWelcome"></span>
                        </div>
                        <button id="loginBtn" onclick="scrollToAccessPanel()" class="bg-brand-500 hover:bg-brand-400 text-slate-900 font-semibold px-5 py-2 rounded-lg transition shadow-lg shadow-brand-500/20">Acesso de bolsista</button>
                        <button id="logoutBtn" onclick="logout()" class="hidden bg-red-500 hover:bg-red-600 text-white font-semibold px-5 py-2 rounded-lg transition shadow-lg shadow-red-500/20">Encerrar sess√£o</button>
                    </div>
                    <div class="grid sm:grid-cols-3 gap-3">
                        <div class="rounded-xl bg-slate-900/60 border border-slate-800 p-4 shadow-inner shadow-slate-900/40">
                            <p class="text-xs uppercase text-slate-400 tracking-[0.2em]">Fluxo</p>
                            <p class="text-lg font-semibold text-brand-200">Cadastro e edi√ß√£o</p>
                            <p class="text-sm text-slate-400">Formul√°rio √∫nico por categoria.</p>
                        </div>
                        <div class="rounded-xl bg-slate-900/60 border border-slate-800 p-4 shadow-inner shadow-slate-900/40">
                            <p class="text-xs uppercase text-slate-400 tracking-[0.2em]">Seguran√ßa</p>
                            <p class="text-lg font-semibold text-brand-200">Acesso controlado</p>
                            <p class="text-sm text-slate-400">Edi√ß√£o s√≥ logado.</p>
                        </div>
                        <div class="rounded-xl bg-slate-900/60 border border-slate-800 p-4 shadow-inner shadow-slate-900/40">
                            <p class="text-xs uppercase text-slate-400 tracking-[0.2em]">Cobertura</p>
                            <p class="text-lg font-semibold text-brand-200">6 √°reas</p>
                            <p class="text-sm text-slate-400">Figurinos, adere√ßos, cenografia, instrumentos, m√∫sica, livros.</p>
                        </div>
                    </div>
                </div>
                <aside id="accessPanel" class="relative bg-slate-900/70 border border-slate-800 rounded-2xl shadow-2xl shadow-brand-500/10 p-6 space-y-4 backdrop-blur">
                    <div class="flex items-center justify-between gap-4">
                        <div class="space-y-1">
                            <p class="text-xs uppercase tracking-[0.2em] text-brand-300">Acesso</p>
                            <h2 class="text-xl font-semibold">Painel do bolsista</h2>
                            <p class="text-sm text-slate-300">Autentique-se para liberar edi√ß√£o e limpeza de dados.</p>
                        </div>
                        <div class="w-12 h-12 rounded-xl bg-brand-500/15 border border-brand-500/30 flex items-center justify-center text-brand-300 text-2xl">üîí</div>
                    </div>
                    <div id="accessWelcome" class="hidden space-y-3 rounded-xl border border-green-500/25 bg-green-500/10 p-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-green-500/15 border border-green-500/25 flex items-center justify-center text-green-200 text-xl">üë§</div>
                            <div>
                                <p class="text-sm text-green-200">Sess√£o ativa</p>
                                <p id="userWelcomePanel" class="text-lg font-semibold text-green-100"></p>
                            </div>
                        </div>
                        <p class="text-sm text-green-200">Use o formul√°rio abaixo para cadastrar, editar e limpar categorias.</p>
                    </div>
                    <div id="accessFormWrapper" class="space-y-4">
                        <form id="loginForm" class="space-y-4">
                            <div>
                                <label for="username" class="block text-sm font-medium mb-1">Usu√°rio</label>
                                <input type="text" id="username" required class="w-full px-3 py-2 bg-slate-950 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-400 text-slate-100">
                            </div>
                            <div>
                                <label for="password" class="block text-sm font-medium mb-1">Senha</label>
                                <input type="password" id="password" required class="w-full px-3 py-2 bg-slate-950 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-400 text-slate-100">
                            </div>
                            <div id="loginError" class="hidden text-red-300 text-sm bg-red-500/10 border border-red-500/30 rounded-lg px-3 py-2"></div>
                            <button type="submit" class="w-full bg-brand-500 hover:bg-brand-400 text-slate-900 font-semibold py-3 rounded-lg transition shadow-lg shadow-brand-500/20">Entrar</button>
                        </form>
                        <div class="rounded-lg bg-slate-950/60 border border-slate-800 p-3 text-sm text-slate-300">
                            Credenciais fornecidas pela coordena√ß√£o do NUARTE.
                        </div>
                    </div>
                </aside>
            </div>
            <div class="space-y-6">
                <div id="editSection" class="hidden bg-slate-900/70 rounded-xl border border-slate-800 p-6 shadow-lg shadow-slate-900/40 max-w-4xl">
                    <h2 class="text-2xl font-bold text-yellow-400 mb-4" id="formTitle">Adicionar Item</h2>
                    <form id="itemForm" class="space-y-4">
                        <input type="hidden" id="editId" value="">
                        <input type="hidden" id="editCategory" value="">
                        
                        <div>
                                <label for="itemCategory" class="block text-sm font-medium mb-1">Categoria</label>
                                <select id="itemCategory" required
                                    class="w-full px-3 py-2 bg-slate-950 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-400 text-slate-100">
                                <option value="">Selecione a categoria...</option>
                                <option value="figurinos">Figurinos</option>
                                <option value="aderecos">Adere√ßos</option>
                                <option value="cenografico">Material Cenogr√°fico</option>
                                <option value="instrumentos">Sala de Instrumentos</option>
                                <option value="musica">Laborat√≥rio de M√∫sica</option>
                                <option value="livros">Livros</option>
                            </select>
                        </div>

                        <div id="dynamicFields" class="grid md:grid-cols-2 gap-4">
                            <!-- Campos din√¢micos ser√£o inseridos aqui -->
                        </div>

                        <div class="flex gap-3">
                            <button type="submit" 
                                    class="flex-1 bg-brand-500 hover:bg-brand-400 text-slate-900 font-semibold py-2 px-4 rounded-lg transition shadow-brand-500/20 shadow-lg">
                                <span id="submitButtonText">Adicionar</span>
                            </button>
                            <button type="button" id="cancelButton" 
                                    class="px-6 bg-slate-800 hover:bg-slate-700 text-slate-100 font-semibold py-2 rounded-lg transition hidden">
                                Cancelar
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Abas de Categorias -->
                <div class="bg-slate-900/70 rounded-xl border border-slate-800 overflow-hidden shadow-lg shadow-slate-900/40">
                    <div class="border-b border-slate-800">
                        <div class="flex overflow-x-auto">
                            <button class="tab-button active px-6 py-4 text-sm font-medium text-slate-100 border-b-2 border-transparent whitespace-nowrap hover:bg-slate-800/50 transition" data-tab="figurinos">
                                Figurinos
                            </button>
                            <button class="tab-button px-6 py-4 text-sm font-medium text-slate-100 border-b-2 border-transparent whitespace-nowrap hover:bg-slate-800/50 transition" data-tab="aderecos">
                                Adere√ßos
                            </button>
                            <button class="tab-button px-6 py-4 text-sm font-medium text-slate-100 border-b-2 border-transparent whitespace-nowrap hover:bg-slate-800/50 transition" data-tab="cenografico">
                                Material Cenogr√°fico
                            </button>
                            <button class="tab-button px-6 py-4 text-sm font-medium text-slate-100 border-b-2 border-transparent whitespace-nowrap hover:bg-slate-800/50 transition" data-tab="instrumentos">
                                Sala de Instrumentos
                            </button>
                            <button class="tab-button px-6 py-4 text-sm font-medium text-slate-100 border-b-2 border-transparent whitespace-nowrap hover:bg-slate-800/50 transition" data-tab="musica">
                                Laborat√≥rio de M√∫sica
                            </button>
                            <button class="tab-button px-6 py-4 text-sm font-medium text-slate-100 border-b-2 border-transparent whitespace-nowrap hover:bg-slate-800/50 transition" data-tab="livros">
                                Livros
                            </button>
                        </div>
                    </div>

                    <!-- Conte√∫do das Abas -->
                    <div id="tabContent" class="p-6">
                        <!-- Conte√∫do ser√° inserido dinamicamente -->
                    </div>
                    <div id="clearButtons" class="hidden p-4 border-t border-slate-800 flex flex-wrap gap-3 justify-between items-center">
                        <button onclick="clearCurrentCategory()" 
                                class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition shadow-md shadow-red-500/20">
                            Limpar Categoria Atual
                        </button>
                        <button onclick="clearAllData()" 
                                class="px-4 py-2 bg-red-700 hover:bg-red-800 text-white font-medium rounded-lg transition shadow-md shadow-red-500/20">
                            Limpar Todos os Dados
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        // Sistema de Autentica√ß√£o
        const users = {
            'bolsista': { password: 'nuarte2026', name: 'Bolsista', role: 'scholar' },
            'admin': { password: 'admin123', name: 'Administrador', role: 'admin' }
        };

        let currentUser = JSON.parse(localStorage.getItem('nuarte_currentUser')) || null;
        const accessPanel = document.getElementById('accessPanel');
        const accessWelcome = document.getElementById('accessWelcome');
        const accessFormWrapper = document.getElementById('accessFormWrapper');
        const userWelcomePanel = document.getElementById('userWelcomePanel');

        function checkAuth() {
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const userInfo = document.getElementById('userInfo');
            const userWelcome = document.getElementById('userWelcome');

            if (currentUser) {
                loginBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
                userInfo.classList.remove('hidden');
                userWelcome.textContent = `üë§ ${currentUser.name}`;
                if (userWelcomePanel) { userWelcomePanel.textContent = currentUser.name; }
                document.getElementById('editSection').classList.remove('hidden');
                document.getElementById('clearButtons').classList.remove('hidden');
                accessFormWrapper.classList.add('hidden');
                accessWelcome.classList.remove('hidden');
            } else {
                loginBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
                userInfo.classList.add('hidden');
                document.getElementById('editSection').classList.add('hidden');
                document.getElementById('clearButtons').classList.add('hidden');
                accessWelcome.classList.add('hidden');
                accessFormWrapper.classList.remove('hidden');
                if (userWelcomePanel) { userWelcomePanel.textContent = ''; }
            }
            renderTable(currentTab);
        }

        function scrollToAccessPanel() {
            accessPanel.scrollIntoView({ behavior: 'smooth', block: 'start' });
            document.getElementById('username').focus();
        }

        function logout() {
            if (confirm('Deseja realmente sair?')) {
                currentUser = null;
                localStorage.removeItem('nuarte_currentUser');
                document.getElementById('loginForm').reset();
                document.getElementById('loginError').classList.add('hidden');
                checkAuth();
            }
        }

        const categoryFields = {
            figurinos: [
                { name: 'name', label: 'Nome do Figurino', type: 'text', required: true },
                { name: 'type', label: 'Tipo', type: 'select', options: ['Teatro', 'Dan√ßa', 'M√∫sica', 'Eventos', 'Outro'], required: true },
                { name: 'size', label: 'Tamanho', type: 'text', placeholder: 'Ex: P, M, G, GG...', required: true },
                { name: 'color', label: 'Cor', type: 'text', required: true },
                { name: 'condition', label: 'Estado', type: 'select', options: ['Novo', 'Bom', 'Regular', 'Necessita Reparo'], required: true },
                { name: 'notes', label: 'Observa√ß√µes', type: 'textarea', required: false }
            ],
            aderecos: [
                { name: 'name', label: 'Nome do Adere√ßo', type: 'text', required: true },
                { name: 'type', label: 'Tipo', type: 'select', options: ['Chap√©u', 'M√°scara', 'Joia', 'Acess√≥rio', 'Outro'], required: true },
                { name: 'quantity', label: 'Quantidade', type: 'number', required: true },
                { name: 'condition', label: 'Estado', type: 'select', options: ['Novo', 'Bom', 'Regular', 'Necessita Reparo'], required: true },
                { name: 'notes', label: 'Observa√ß√µes', type: 'textarea', required: false }
            ],
            cenografico: [
                { name: 'name', label: 'Nome do Material', type: 'text', required: true },
                { name: 'type', label: 'Tipo', type: 'select', options: ['Painel', 'Mob√≠lia', 'Decora√ß√£o', 'Estrutura', 'Outro'], required: true },
                { name: 'dimensions', label: 'Dimens√µes', type: 'text', placeholder: 'Ex: 2m x 1m', required: false },
                { name: 'quantity', label: 'Quantidade', type: 'number', required: true },
                { name: 'condition', label: 'Estado', type: 'select', options: ['Novo', 'Bom', 'Regular', 'Necessita Reparo'], required: true },
                { name: 'notes', label: 'Observa√ß√µes', type: 'textarea', required: false }
            ],
            instrumentos: [
                { name: 'name', label: 'Nome do Instrumento', type: 'text', required: true },
                { name: 'type', label: 'Tipo', type: 'select', options: ['Corda', 'Sopro', 'Percuss√£o', 'Teclado', 'Eletr√¥nico', 'Outro'], required: true },
                { name: 'brand', label: 'Marca', type: 'text', required: false },
                { name: 'serialNumber', label: 'N√∫mero de S√©rie', type: 'text', required: false },
                { name: 'condition', label: 'Estado', type: 'select', options: ['Novo', 'Bom', 'Regular', 'Necessita Manuten√ß√£o'], required: true },
                { name: 'notes', label: 'Observa√ß√µes', type: 'textarea', required: false }
            ],
            musica: [
                { name: 'name', label: 'Nome do Equipamento', type: 'text', required: true },
                { name: 'type', label: 'Tipo', type: 'select', options: ['Mesa de Som', 'Amplificador', 'Microfone', 'Caixa de Som', 'Cabo', 'Acess√≥rio', 'Outro'], required: true },
                { name: 'brand', label: 'Marca', type: 'text', required: false },
                { name: 'quantity', label: 'Quantidade', type: 'number', required: true },
                { name: 'condition', label: 'Estado', type: 'select', options: ['Novo', 'Bom', 'Regular', 'Necessita Reparo'], required: true },
                { name: 'notes', label: 'Observa√ß√µes', type: 'textarea', required: false }
            ],
            livros: [
                { name: 'title', label: 'T√≠tulo', type: 'text', required: true },
                { name: 'author', label: 'Autor', type: 'text', required: true },
                { name: 'category', label: 'Categoria', type: 'select', options: ['Teatro', 'M√∫sica', 'Dan√ßa', 'Artes Visuais', 'Hist√≥ria da Arte', 'T√©cnica', 'Outro'], required: true },
                { name: 'isbn', label: 'ISBN', type: 'text', required: false },
                { name: 'year', label: 'Ano', type: 'number', required: false },
                { name: 'condition', label: 'Estado', type: 'select', options: ['Novo', 'Bom', 'Regular', 'Danificado'], required: true },
                { name: 'notes', label: 'Observa√ß√µes', type: 'textarea', required: false }
            ]
        };

        let data = {};
        let nextIds = {};
        const categories = ['figurinos', 'aderecos', 'cenografico', 'instrumentos', 'musica', 'livros'];
        
        const exampleData = {
            figurinos: [
                { id: 1, name: 'Vestido de √âpoca Vitoriano', type: 'Teatro', size: 'M', color: 'Vermelho Bord√¥', condition: 'Bom', notes: 'Usado na pe√ßa "Noite de Reis"' },
                { id: 2, name: 'Roupa de Palha√ßo', type: 'Teatro', size: 'G', color: 'Colorido', condition: 'Regular', notes: 'Necessita lavagem' },
                { id: 3, name: 'Tutu de Ballet', type: 'Dan√ßa', size: 'P', color: 'Branco', condition: 'Novo', notes: 'Adquirido em 2025' }
            ],
            aderecos: [
                { id: 1, name: 'Cartola Preta', type: 'Chap√©u', quantity: '3', condition: 'Bom', notes: 'Para apresenta√ß√µes formais' },
                { id: 2, name: 'M√°scaras Venezianas', type: 'M√°scara', quantity: '12', condition: 'Novo', notes: 'Conjunto completo' },
                { id: 3, name: 'Coroa Dourada', type: 'Acess√≥rio', quantity: '2', condition: 'Regular', notes: 'Uma precisa de ajuste' }
            ],
            cenografico: [
                { id: 1, name: 'Painel de Fundo - Floresta', type: 'Painel', dimensions: '4m x 3m', quantity: '1', condition: 'Bom', notes: 'Pintura em lona' },
                { id: 2, name: 'Mesa Antiga de Madeira', type: 'Mob√≠lia', dimensions: '1.5m x 0.8m', quantity: '2', condition: 'Regular', notes: 'Necessita restaura√ß√£o' },
                { id: 3, name: 'Colunas Gregas', type: 'Estrutura', dimensions: '2.5m altura', quantity: '4', condition: 'Bom', notes: 'Material PVC' }
            ],
            instrumentos: [
                { id: 1, name: 'Viol√£o Cl√°ssico', type: 'Corda', brand: 'Giannini', serialNumber: 'GC-01-2020', condition: 'Bom', notes: 'Cordas trocadas em 12/2025' },
                { id: 2, name: 'Flauta Transversal', type: 'Sopro', brand: 'Yamaha', serialNumber: 'YFL-222', condition: 'Novo', notes: 'Aquisi√ß√£o recente' },
                { id: 3, name: 'Bateria Completa', type: 'Percuss√£o', brand: 'Pearl', serialNumber: 'EXX725S', condition: 'Regular', notes: 'Peles precisam ser trocadas' }
            ],
            musica: [
                { id: 1, name: 'Mesa de Som Digital', type: 'Mesa de Som', brand: 'Behringer', quantity: '1', condition: 'Bom', notes: '16 canais, modelo X32' },
                { id: 2, name: 'Microfone Condensador', type: 'Microfone', brand: 'Shure', quantity: '4', condition: 'Novo', notes: 'Modelo SM58' },
                { id: 3, name: 'Caixa Amplificada', type: 'Caixa de Som', brand: 'JBL', quantity: '2', condition: 'Bom', notes: '15 polegadas, 1000W' }
            ],
            livros: [
                { id: 1, title: 'O Teatro e seu Duplo', author: 'Antonin Artaud', category: 'Teatro', isbn: '978-8533613447', year: '2006', condition: 'Bom', notes: 'Edi√ß√£o Martins Fontes' },
                { id: 2, title: 'Hist√≥ria da M√∫sica Ocidental', author: 'Donald J. Grout', category: 'M√∫sica', isbn: '978-8515037803', year: '2007', condition: 'Regular', notes: 'P√°ginas amareladas' },
                { id: 3, title: 'Dan√ßa: Arte do Movimento', author: 'Klauss Vianna', category: 'Dan√ßa', isbn: '978-8532308535', year: '2005', condition: 'Novo', notes: 'Doa√ß√£o recente' }
            ]
        };
        
        categories.forEach(cat => {
            const stored = localStorage.getItem(`nuarte_${cat}`);
            if (stored) {
                data[cat] = JSON.parse(stored);
                nextIds[cat] = parseInt(localStorage.getItem(`nuarte_${cat}_nextId`)) || 1;
            } else {
                data[cat] = exampleData[cat];
                nextIds[cat] = (exampleData[cat].length || 0) + 1;
                localStorage.setItem(`nuarte_${cat}`, JSON.stringify(data[cat]));
                localStorage.setItem(`nuarte_${cat}_nextId`, nextIds[cat]);
            }
        });

        let currentTab = 'figurinos';

        const form = document.getElementById('itemForm');
        const categorySelect = document.getElementById('itemCategory');
        const dynamicFields = document.getElementById('dynamicFields');
        const formTitle = document.getElementById('formTitle');
        const submitButtonText = document.getElementById('submitButtonText');
        const cancelButton = document.getElementById('cancelButton');
        const editIdInput = document.getElementById('editId');
        const editCategoryInput = document.getElementById('editCategory');
        const tabContent = document.getElementById('tabContent');

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('loginForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const loginError = document.getElementById('loginError');

                if (users[username] && users[username].password === password) {
                    currentUser = { name: users[username].name, role: users[username].role, username };
                    localStorage.setItem('nuarte_currentUser', JSON.stringify(currentUser));
                    loginError.classList.add('hidden');
                    document.getElementById('loginForm').reset();
                    accessFormWrapper.classList.add('hidden');
                    accessWelcome.classList.remove('hidden');
                    checkAuth();
                } else {
                    loginError.textContent = 'Usu√°rio ou senha incorretos!';
                    loginError.classList.remove('hidden');
                }
            });
        });

        categorySelect.addEventListener('change', (e) => {
            const category = e.target.value;
            if (!category) {
                dynamicFields.innerHTML = '';
                return;
            }

            const fields = categoryFields[category];
            dynamicFields.innerHTML = fields.map(field => {
                if (field.type === 'select') {
                    return `<div><label for="field_${field.name}" class="block text-sm font-medium mb-1">${field.label}</label><select id="field_${field.name}" ${field.required ? 'required' : ''} class="w-full px-3 py-2 bg-slate-950 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-400 text-slate-100"><option value="">Selecione...</option>${field.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}</select></div>`;
                } else if (field.type === 'textarea') {
                    return `<div class="md:col-span-2"><label for="field_${field.name}" class="block text-sm font-medium mb-1">${field.label}</label><textarea id="field_${field.name}" rows="3" ${field.required ? 'required' : ''} class="w-full px-3 py-2 bg-slate-950 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-400 text-slate-100"></textarea></div>`;
                } else {
                    return `<div><label for="field_${field.name}" class="block text-sm font-medium mb-1">${field.label}</label><input type="${field.type}" id="field_${field.name}" ${field.required ? 'required' : ''} ${field.placeholder ? `placeholder="${field.placeholder}"` : ''} class="w-full px-3 py-2 bg-slate-950 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-400 text-slate-100"></div>`;
                }
            }).join('');
        });

        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                currentTab = e.target.dataset.tab;
                renderTable(currentTab);
            });
        });

        function renderTable(category) {
            const items = data[category];
            const fields = categoryFields[category];
            const isAuthenticated = currentUser !== null;
            
            if (items.length === 0) {
                tabContent.innerHTML = `<div class="p-12 text-center text-slate-400 bg-slate-900/60 border border-slate-800 rounded-xl"><svg class="mx-auto h-12 w-12 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" /></svg><p class="text-lg font-semibold text-slate-100">Nenhum item nesta categoria</p><p class="text-sm text-slate-400">${isAuthenticated ? 'Cadastre um item no formul√°rio acima.' : 'Autentique-se como bolsista para cadastrar.'}</p></div>`;
                return;
            }

            const headers = isAuthenticated ? ['ID', ...fields.map(f => f.label), 'A√ß√µes'] : ['ID', ...fields.map(f => f.label)];
            
            tabContent.innerHTML = `<div class="overflow-x-auto"><table class="w-full rounded-xl overflow-hidden"><thead class="bg-slate-900/80"><tr>${headers.map(h => `<th class="px-6 py-3 text-left text-xs font-semibold text-slate-200 uppercase tracking-[0.15em]">${h}</th>`).join('')}</tr></thead><tbody class="divide-y divide-slate-800">${items.map(item => `<tr class="hover:bg-slate-900/60 transition"><td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-brand-200">#${item.id}</td>${fields.map(f => {
                let value = item[f.name] || '-';
                if (f.name === 'condition') {
                    return `<td class="px-6 py-4 whitespace-nowrap text-sm"><span class="px-2 py-1 text-xs font-semibold rounded-full ${getConditionBadge(value)}">${value}</span></td>`;
                }
                return `<td class="px-6 py-4 whitespace-nowrap text-sm">${value}</td>`;
            }).join('')}${isAuthenticated ? `<td class="px-6 py-4 whitespace-nowrap text-center text-sm"><button onclick="editItem('${category}', ${item.id})" class="text-brand-300 hover:text-brand-200 mr-4 font-semibold transition">Editar</button><button onclick="deleteItem('${category}', ${item.id})" class="text-red-300 hover:text-red-200 font-semibold transition">Remover</button></td>` : ''}</tr>`).join('')}</tbody></table></div>`;
        }

        function getConditionBadge(condition) {
            const badges = {'Novo': 'bg-green-500/20 text-green-400', 'Bom': 'bg-blue-500/20 text-blue-400', 'Regular': 'bg-yellow-500/20 text-yellow-400', 'Necessita Reparo': 'bg-red-500/20 text-red-400', 'Necessita Manuten√ß√£o': 'bg-red-500/20 text-red-400', 'Danificado': 'bg-red-500/20 text-red-400'};
            return badges[condition] || 'bg-slate-500/20 text-slate-400';
        }

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const category = editCategoryInput.value || categorySelect.value;
            if (!category) return;
            const fields = categoryFields[category];
            const item = {};
            fields.forEach(field => { item[field.name] = document.getElementById(`field_${field.name}`).value; });
            const editId = editIdInput.value;
            if (editId) {
                const index = data[category].findIndex(i => i.id === parseInt(editId));
                if (index !== -1) { data[category][index] = { ...item, id: parseInt(editId) }; }
                resetForm();
            } else {
                item.id = nextIds[category]++;
                data[category].push(item);
                localStorage.setItem(`nuarte_${category}_nextId`, nextIds[category]);
            }
            localStorage.setItem(`nuarte_${category}`, JSON.stringify(data[category]));
            renderTable(category);
            if (!editId) currentTab = category;
            document.querySelectorAll('.tab-button').forEach(btn => { btn.classList.toggle('active', btn.dataset.tab === category); });
            form.reset();
        });

        window.editItem = function(category, id) {
            const item = data[category].find(i => i.id === id);
            if (!item) return;
            const fields = categoryFields[category];
            categorySelect.value = category;
            categorySelect.dispatchEvent(new Event('change'));
            setTimeout(() => {
                fields.forEach(field => { const input = document.getElementById(`field_${field.name}`); if (input) input.value = item[field.name] || ''; });
                editIdInput.value = id;
                editCategoryInput.value = category;
                categorySelect.disabled = true;
                formTitle.textContent = 'Editar Item';
                submitButtonText.textContent = 'Atualizar';
                cancelButton.classList.remove('hidden');
                form.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        };

        cancelButton.addEventListener('click', resetForm);

        function resetForm() {
            form.reset();
            dynamicFields.innerHTML = '';
            editIdInput.value = '';
            editCategoryInput.value = '';
            categorySelect.disabled = false;
            formTitle.textContent = 'Adicionar Item';
            submitButtonText.textContent = 'Adicionar';
            cancelButton.classList.add('hidden');
        }

        window.deleteItem = function(category, id) {
            if (!currentUser) { alert('Voc√™ precisa fazer login como bolsista para remover itens!'); return; }
            if (confirm('Deseja realmente remover este item?')) {
                data[category] = data[category].filter(i => i.id !== id);
                localStorage.setItem(`nuarte_${category}`, JSON.stringify(data[category]));
                renderTable(category);
            }
        };

        window.clearCurrentCategory = function() {
            if (!currentUser) { alert('Voc√™ precisa fazer login como bolsista para limpar categorias!'); return; }
            const categoryNames = {'figurinos': 'Figurinos', 'aderecos': 'Adere√ßos', 'cenografico': 'Material Cenogr√°fico', 'instrumentos': 'Sala de Instrumentos', 'musica': 'Laborat√≥rio de M√∫sica', 'livros': 'Livros'};
            if (confirm(`Deseja realmente limpar TODOS os itens de ${categoryNames[currentTab]}?\n\nEsta a√ß√£o n√£o pode ser desfeita!`)) {
                data[currentTab] = [];
                nextIds[currentTab] = 1;
                localStorage.setItem(`nuarte_${currentTab}`, JSON.stringify(data[currentTab]));
                localStorage.setItem(`nuarte_${currentTab}_nextId`, nextIds[currentTab]);
                renderTable(currentTab);
            }
        };

        window.clearAllData = function() {
            if (!currentUser) { alert('Voc√™ precisa fazer login como bolsista para limpar todos os dados!'); return; }
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO!\n\nDeseja realmente limpar TODOS os dados de TODAS as categorias?\n\nEsta a√ß√£o n√£o pode ser desfeita!')) {
                if (confirm('Tem certeza absoluta? Esta √© sua √∫ltima chance antes de perder todos os dados!')) {
                    categories.forEach(cat => {
                        data[cat] = [];
                        nextIds[cat] = 1;
                        localStorage.removeItem(`nuarte_${cat}`);
                        localStorage.removeItem(`nuarte_${cat}_nextId`);
                    });
                    renderTable(currentTab);
                    alert('Todos os dados foram removidos com sucesso!');
                }
            }
        };

        checkAuth();
        renderTable(currentTab);
    </script>
</body>
</html>
